#!/usr/bin/python
#*************************************************************************
# Desc: This script extracts the results of an experiment of RM
#       and prints only the test condition and acc
# Inputs:
#   Experiment Directory
#   No. of LM weights used
# Output: stdout
#*************************************************************************

import subprocess
import sys

if ( len(sys.argv)<2 or len(sys.argv)>3 ):
    print ("Usage: parse_results expt_name [verbose_level]")
    print ("verbose_level: 1 - Print Test Name")
    sys.exit(1)

expt_name = sys.argv[1]
verbose = 0

if ( len(sys.argv)==3 ):
    verbose = sys.argv[2]

p = subprocess.Popen("find "+expt_name+" -maxdepth 1 -name \"decode*\""\
        + " -type d | awk '{system(\"grep WER \"$1\"/wer_*\")}'"\
        + " | sort"\
        , shell=True, stdout=subprocess.PIPE);
p.wait();

acc = { '': 0.0,
        'feb89': 0.0,
        'feb91': 0.0,
        'oct89': 0.0,
        'mar87': 0.0,
        'oct87': 0.0,
        'sep92': 0.0
};

tests = [ '',
        'feb89',
        'feb91',
        'oct89',
        'mar87',
        'sep92',
        'oct87'
];

for line in p.stdout.readlines():
    line1=line.split('[')[0]
    if (line1.rfind('decode_test') != -1):
        line2=line1.split('/decode_test')[1]
    else:
        line2=line1.split('/decode')[1]
    if(line2[0]=='/'):
        test=''
    else:
        test=line2[1:].split('/')[0]
        line2=line2[1:]
    acc[test]=max(acc[test],100.0-float(line2.split('WER ')[1]))

for i in range(0,len(tests)):
    if ( int(verbose) == 1 ):
        print( tests[i]+' '+str(acc[tests[i]]) )
    else:
        print(str(acc[tests[i]]))
